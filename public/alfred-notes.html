<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfred Notes</title>

    <!-- Retro-futurist fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Neo-retro palette - DARK MODE (default) */
            --primary-blue: #5B8CFF;
            --primary-blue-light: #25294A;
            --secondary-purple: #B084FF;
            --accent-cyan: #5FFCF9;
            --accent-pink: #FF7AD9;

            --bg-deep: #050816;
            --bg-light: #0C1024;
            --bg-panel: #11152B;
            --bg-elevated: #171C37;
            --bg-chip: #1F2442;

            --text-primary: #F7F7FF;
            --text-secondary: #B0B4D0;
            --text-tertiary: #7C81A8;

            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-strong: rgba(255, 255, 255, 0.16);

            --red: #FF5C5C;
            --green: #3ED598;
            --success-green: #3ED598;

            --shadow-soft: 0 18px 45px rgba(5, 8, 22, 0.95);
            --shadow-chip: 0 0 0 1px rgba(255, 255, 255, 0.04);

            --radius-lg: 18px;
            --radius-xl: 28px;

            --transition-fast: 0.18s ease-out;
        }

        /* LIGHT MODE - Retro-futuristic pastel palette */
        [data-theme="light"] {
            --primary-blue: #4A7BFF;
            --primary-blue-light: #E8ECFF;
            --secondary-purple: #9B6FFF;
            --accent-cyan: #00D4D4;
            --accent-pink: #FF5DC4;

            --bg-deep: #F5F6FA;
            --bg-light: #FAFBFF;
            --bg-panel: #FFFFFF;
            --bg-elevated: #F8F9FE;
            --bg-chip: #EFF1F9;

            --text-primary: #1A1D2E;
            --text-secondary: #4A5373;
            --text-tertiary: #7A8099;

            --border-subtle: rgba(74, 83, 115, 0.12);
            --border-strong: rgba(74, 83, 115, 0.25);

            --red: #FF4757;
            --green: #2ECC71;
            --success-green: #2ECC71;

            --shadow-soft: 0 18px 45px rgba(74, 83, 115, 0.15);
            --shadow-chip: 0 0 0 1px rgba(74, 83, 115, 0.08);
        }

        /* Light mode specific adjustments */
        [data-theme="light"] .record-button {
            box-shadow:
                0 20px 40px rgba(74, 83, 115, 0.25),
                0 0 35px rgba(0, 212, 212, 0.4);
        }

        [data-theme="light"] .record-button:hover {
            box-shadow:
                0 26px 48px rgba(74, 83, 115, 0.35),
                0 0 45px rgba(0, 212, 212, 0.5);
        }

        [data-theme="light"] .record-button.recording {
            box-shadow:
                0 20px 40px rgba(74, 83, 115, 0.35),
                0 0 40px rgba(255, 71, 87, 0.6);
        }

        [data-theme="light"] .app-title {
            text-shadow: 0 0 8px rgba(0, 212, 212, 0.5);
        }

        [data-theme="light"] .nav-item.active {
            box-shadow: 0 0 0 1px rgba(0, 212, 212, 0.4), 0 0 20px rgba(0, 212, 212, 0.4);
        }

        [data-theme="light"] .template-card:hover {
            box-shadow: 0 18px 40px rgba(74, 83, 115, 0.25);
        }

        [data-theme="light"] .note-card:hover {
            box-shadow: 0 22px 46px rgba(74, 83, 115, 0.25);
        }

        [data-theme="light"] .auth-modal {
            background: radial-gradient(circle at top, rgba(74, 123, 255, 0.15), transparent 60%) rgba(245, 246, 250, 0.92);
        }

        [data-theme="light"] .send-button {
            box-shadow: 0 0 20px rgba(0, 212, 212, 0.6);
        }

        [data-theme="light"] .primary-button {
            box-shadow: 0 16px 34px rgba(74, 83, 115, 0.25), 0 0 26px rgba(0, 212, 212, 0.5);
        }

        [data-theme="light"] .recording-panel {
            border: 1px solid rgba(255, 71, 87, 0.5);
        }

        [data-theme="light"] .logout-btn {
            color: var(--text-primary);
        }

        body {
            font-family: "Space Grotesk", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background:
                radial-gradient(circle at 0% 0%, rgba(91, 140, 255, 0.18), transparent 55%),
                radial-gradient(circle at 100% 0%, rgba(255, 122, 217, 0.18), transparent 55%),
                radial-gradient(circle at 50% 100%, rgba(95, 252, 249, 0.08), transparent 55%),
                linear-gradient(145deg, #050816 0%, #050816 40%, #050A24 100%);
            color: var(--text-primary);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            transition: background 0.3s ease;
        }

        [data-theme="light"] body {
            background:
                radial-gradient(circle at 0% 0%, rgba(74, 123, 255, 0.12), transparent 55%),
                radial-gradient(circle at 100% 0%, rgba(255, 93, 196, 0.12), transparent 55%),
                radial-gradient(circle at 50% 100%, rgba(0, 212, 212, 0.08), transparent 55%),
                linear-gradient(145deg, #F5F6FA 0%, #FAFBFF 40%, #F8F9FE 100%);
        }

        /* Global cards / glass */
        .glass {
            background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.08), transparent 40%) var(--bg-panel);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(20px);
        }

        .chip {
            background: var(--bg-chip);
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-chip);
        }

        /* Main Container */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 10px 0;
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, rgba(95, 252, 249, 0.05), rgba(91, 140, 255, 0.05)) var(--bg-panel);
            padding: 10px 18px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-soft);
        }

        .app-title {
            font-family: "Press Start 2P", system-ui;
            font-size: 12px;
            letter-spacing: 0.09em;
            text-transform: uppercase;
            color: var(--accent-cyan);
            text-shadow: 0 0 8px rgba(95, 252, 249, 0.65);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-title::before {
            content: "‚ñå‚ñà‚ñê";
            font-size: 10px;
            opacity: 0.8;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .user-info span {
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(15, 20, 50, 0.9);
            border: 1px solid var(--border-subtle);
        }

        .theme-toggle {
            padding: 6px 12px;
            background: var(--bg-chip);
            color: var(--accent-cyan);
            border: 1px solid var(--border-subtle);
            border-radius: 999px;
            cursor: pointer;
            font-size: 16px;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .theme-toggle:hover {
            background: var(--bg-elevated);
            transform: scale(1.08);
        }

        .logout-btn {
            padding: 6px 12px;
            background: radial-gradient(circle at 0 0, rgba(255, 92, 92, 0.28), transparent 55%) var(--bg-panel);
            color: white;
            border: 1px solid rgba(255, 92, 92, 0.7);
            border-radius: 999px;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .logout-btn:hover {
            background: var(--red);
        }

        /* Content Area */
        .app-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            margin-top: 14px;
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-subtle);
            background: radial-gradient(circle at top, rgba(91, 140, 255, 0.06), transparent 52%) var(--bg-light);
        }

        .view-container {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .view-container.active {
            display: flex;
        }

        /* Bottom Navigation */
        .bottom-nav {
            margin-top: 10px;
            background: linear-gradient(135deg, rgba(9, 11, 35, 0.95), rgba(9, 11, 35, 0.98));
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-around;
            padding: 6px 4px;
            box-shadow: var(--shadow-soft);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 18px;
            cursor: pointer;
            color: var(--text-tertiary);
            border: none;
            background: none;
            font-size: 9px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            transition: color var(--transition-fast), transform var(--transition-fast), background var(--transition-fast), box-shadow var(--transition-fast);
            border-radius: 999px;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .nav-item.active {
            color: var(--accent-cyan);
            background: radial-gradient(circle at 50% 0%, rgba(95, 252, 249, 0.22), transparent 65%) var(--bg-chip);
            box-shadow: 0 0 0 1px rgba(95, 252, 249, 0.4), 0 0 24px rgba(95, 252, 249, 0.5);
            transform: translateY(-1px);
        }

        /* Home View */
        .home-view {
            padding: 32px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
        }

        .record-button {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.35), transparent 50%),
                conic-gradient(from 210deg, var(--accent-cyan), var(--secondary-purple), var(--accent-pink), var(--accent-cyan));
            position: relative;
            border: none;
            cursor: pointer;
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.75),
                0 0 40px rgba(91, 140, 255, 0.6);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast);
        }

        .record-button::before {
            content: "";
            position: absolute;
            inset: 14px;
            border-radius: inherit;
            background: radial-gradient(circle at top, rgba(255, 255, 255, 0.08), transparent 60%) var(--bg-panel);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .record-button span {
            position: relative;
            font-size: 46px;
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.8));
        }

        .record-button:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow:
                0 26px 48px rgba(0, 0, 0, 0.9),
                0 0 52px rgba(95, 252, 249, 0.7);
        }

        .record-button.recording {
            background:
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.4), transparent 50%),
                conic-gradient(from 180deg, #ff7b7b, #ff3b3b, #ff7b7b, #ff3b3b);
            animation: pulse 1.4s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.85), 0 0 40px rgba(255, 123, 123, 0.7); }
            50% { transform: scale(1.04); box-shadow: 0 26px 52px rgba(0, 0, 0, 0.95), 0 0 55px rgba(255, 123, 123, 0.95); }
        }

        .template-selector {
            width: 100%;
            max-width: 520px;
        }

        .template-title {
            font-family: "Press Start 2P", system-ui;
            font-size: 11px;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            margin-bottom: 18px;
            text-align: center;
            color: var(--text-secondary);
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
        }

        .template-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 18px 12px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-chip);
            position: relative;
            overflow: hidden;
        }

        .template-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(95, 252, 249, 0.08), rgba(176, 132, 255, 0.08));
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .template-card:hover {
            border-color: rgba(95, 252, 249, 0.6);
            transform: translateY(-3px);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
        }

        .template-card.selected {
            border-color: rgba(95, 252, 249, 0.85);
            background: radial-gradient(circle at top, rgba(95, 252, 249, 0.18), transparent 60%) var(--bg-panel);
        }

        .template-card.selected::before {
            opacity: 1;
        }

        .template-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .template-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Library View */
        .library-view {
            background: transparent;
        }

        .library-header {
            padding: 16px 20px 4px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--bg-panel);
            border-radius: 999px;
            padding: 8px 14px;
            gap: 10px;
            border: 1px solid var(--border-subtle);
        }

        .search-bar span {
            opacity: 0.8;
        }

        .search-bar input {
            flex: 1;
            border: none;
            background: none;
            font-size: 14px;
            outline: none;
            color: var(--text-primary);
        }

        .search-bar input::placeholder {
            color: var(--text-tertiary);
        }

        .filter-button {
            margin-top: 10px;
            padding: 8px 14px;
            background: var(--bg-chip);
            color: var(--accent-cyan);
            border: 1px dashed rgba(95, 252, 249, 0.6);
            border-radius: 999px;
            font-size: 11px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.12em;
        }

        .notes-list {
            padding: 12px 20px 22px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note-card {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            padding: 14px 16px;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), border var(--transition-fast);
            border: 1px solid var(--border-subtle);
            position: relative;
            overflow: hidden;
        }

        .note-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(95, 252, 249, 0.12), transparent 60%);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .note-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 22px 46px rgba(0, 0, 0, 0.95);
            border-color: rgba(95, 252, 249, 0.5);
        }

        .note-card:hover::after {
            opacity: 1;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .note-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .note-badge {
            font-family: "Press Start 2P", system-ui;
            background: var(--bg-chip);
            color: var(--accent-cyan);
            padding: 4px 7px;
            border-radius: 999px;
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            border: 1px solid rgba(95, 252, 249, 0.7);
        }

        .note-preview {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* Chat View */
        .chat-view {
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 16px 20px 8px;
        }

        .chat-toggle {
            display: inline-flex;
            background: var(--bg-panel);
            border-radius: 999px;
            padding: 4px;
            gap: 4px;
            border: 1px solid var(--border-subtle);
        }

        .chat-toggle-btn {
            flex: 1;
            padding: 7px 16px;
            border: none;
            background: none;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all var(--transition-fast);
        }

        .chat-toggle-btn.active {
            background: radial-gradient(circle at 30% 0%, rgba(95, 252, 249, 0.25), transparent 60%) var(--bg-chip);
            color: var(--accent-cyan);
            box-shadow: 0 0 0 1px rgba(95, 252, 249, 0.6);
        }

        .chat-messages {
            flex: 1;
            padding: 18px 20px 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .message {
            display: flex;
            gap: 10px;
            max-width: 80%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.25), transparent 60%) var(--bg-chip);
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
            font-family: "Press Start 2P", system-ui;
            font-size: 9px;
            border: 1px solid rgba(95, 252, 249, 0.6);
        }

        .message-content {
            background: var(--bg-panel);
            padding: 10px 14px;
            border-radius: 14px;
            box-shadow: var(--shadow-chip);
            border: 1px solid var(--border-subtle);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(95, 252, 249, 0.18), rgba(91, 140, 255, 0.45));
            color: white;
            border-color: rgba(95, 252, 249, 0.6);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.55;
        }

        .chat-input-container {
            background: linear-gradient(180deg, rgba(5, 8, 22, 0.2), rgba(5, 8, 22, 0.7));
            border-top: 1px solid var(--border-subtle);
            padding: 14px 20px 18px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border-subtle);
            border-radius: 999px;
            font-size: 14px;
            outline: none;
            resize: none;
            font-family: inherit;
            min-height: 40px;
            max-height: 96px;
            background: var(--bg-panel);
            color: var(--text-primary);
        }

        .chat-input::placeholder {
            color: var(--text-tertiary);
        }

        .send-button {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 0%, rgba(255, 255, 255, 0.18), transparent 55%) var(--accent-cyan);
            color: #050816;
            border: none;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(95, 252, 249, 0.8);
        }

        .send-button:disabled {
            background: var(--border-subtle);
            box-shadow: none;
            cursor: not-allowed;
        }

        /* Settings View */
        .settings-view {
            padding: 20px;
        }

        .settings-section {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            padding: 18px 18px 14px;
            margin-bottom: 16px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
        }

        .section-title {
            font-family: "Press Start 2P", system-ui;
            font-size: 10px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            margin-bottom: 12px;
            color: var(--accent-cyan);
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: var(--text-primary);
        }

        .setting-description {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .toggle-switch {
            position: relative;
            width: 46px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-subtle);
            transition: 0.3s;
            border-radius: 26px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #050816;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--accent-cyan), var(--green));
        }

        input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }

        .model-select {
            padding: 8px 12px;
            border: 1px solid var(--border-subtle);
            border-radius: 999px;
            font-size: 13px;
            background: var(--bg-panel);
            color: var(--text-primary);
            cursor: pointer;
            outline: none;
        }

        /* Note Detail View */
        .note-detail-view {
            padding: 20px;
        }

        .note-detail-header {
            background: var(--bg-panel);
            padding: 18px 18px 14px;
            border-radius: var(--radius-lg);
            margin-bottom: 16px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
        }

        .note-detail-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .note-detail-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .summary-section {
            background: var(--bg-panel);
            padding: 18px;
            border-radius: var(--radius-lg);
            margin-bottom: 14px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-soft);
        }

        .summary-heading {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent-cyan);
        }

        .summary-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .summary-list li {
            padding-left: 18px;
            position: relative;
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .summary-list li:before {
            content: "‚óÜ";
            position: absolute;
            left: 4px;
            color: var(--accent-cyan);
            font-size: 10px;
        }

        /* Buttons */
        .primary-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--secondary-purple));
            color: #050816;
            border: none;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            box-shadow: 0 16px 34px rgba(0, 0, 0, 0.9), 0 0 26px rgba(95, 252, 249, 0.7);
        }

        .primary-button:hover {
            filter: brightness(1.08);
        }

        .secondary-button {
            width: 100%;
            padding: 10px 18px;
            background: var(--bg-panel);
            color: var(--text-primary);
            border-radius: 999px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border-subtle);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 16px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border-subtle);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(91, 140, 255, 0.28), transparent 60%) rgba(5, 8, 22, 0.92);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-card {
            background: var(--bg-panel);
            padding: 26px 24px 20px;
            border-radius: var(--radius-lg);
            max-width: 420px;
            width: 92%;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-strong);
        }

        .auth-title {
            font-family: "Press Start 2P", system-ui;
            font-size: 13px;
            letter-spacing: 0.16em;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            color: var(--accent-cyan);
        }

        .form-group {
            margin-bottom: 14px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-subtle);
            border-radius: 999px;
            font-size: 13px;
            outline: none;
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .form-input:focus {
            border-color: rgba(95, 252, 249, 0.8);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 14px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .auth-toggle a {
            color: var(--accent-cyan);
            text-decoration: none;
            font-weight: 500;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 18px;
            background: var(--bg-panel);
            padding: 12px 16px;
            border-radius: 14px;
            box-shadow: var(--shadow-soft);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideIn 0.25s ease;
            font-size: 13px;
            border: 1px solid var(--border-subtle);
        }

        .toast.hidden {
            display: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(260px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 3px solid var(--green);
        }

        .toast.error {
            border-left: 3px solid var(--red);
        }

        /* Recording Panel */
        .recording-panel {
            position: fixed;
            bottom: 14px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-panel);
            padding: 14px 20px;
            box-shadow: var(--shadow-soft);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 999;
            border-radius: 999px;
            border: 1px solid rgba(255, 92, 92, 0.6);
        }

        .recording-panel.active {
            display: flex;
        }

        .recording-timer {
            font-family: "Press Start 2P", system-ui;
            font-size: 11px;
            letter-spacing: 0.16em;
            color: var(--red);
        }

        .recording-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stop-recording-btn {
            padding: 8px 16px;
            background: var(--red);
            color: #050816;
            border: none;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.14em;
        }

        /* Empty State */
        .empty-state {
            padding: 50px 20px;
            text-align: center;
            color: var(--text-tertiary);
        }

        .empty-icon {
            font-size: 54px;
            margin-bottom: 12px;
        }

        .empty-text {
            font-size: 15px;
            font-weight: 500;
        }

        /* Scrollbars */
        .view-container::-webkit-scrollbar,
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .view-container::-webkit-scrollbar-thumb,
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--border-subtle);
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 8px 8px 0;
            }
            .note-card {
                padding: 12px 12px;
            }
            .home-view {
                padding: 24px 16px;
            }
            .record-button {
                width: 180px;
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <!-- BODY + SCRIPT remain unchanged from your original file -->
    <!-- ... Paste the existing <body> content and <script> exactly as-is ... -->

    <!-- BEGIN ORIGINAL BODY CONTENT -->
    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <div class="app-title">Alfred Notes</div>
            <div class="user-info">
                <button class="theme-toggle" onclick="alfredApp.toggleTheme()" title="Toggle theme" id="themeToggle">
                    üåô
                </button>
                <span id="userEmail">Loading...</span>
                <button class="logout-btn" onclick="alfredApp.logout()">Logout</button>
            </div>
        </div>

        <!-- Content Views -->
        <div class="app-content">
            <!-- Home View -->
            <div id="homeView" class="view-container active">
                <div class="home-view">
                    <button class="record-button" id="recordButton" onclick="alfredApp.toggleRecording()">
                        <span id="recordIcon">üé§</span>
                    </button>

                    <div class="template-selector">
                        <h3 class="template-title">Select Template</h3>
                        <div class="template-grid">
                            <div class="template-card selected" data-template="MEETING">
                                <div class="template-icon">üë•</div>
                                <div class="template-name">Meeting</div>
                            </div>
                            <div class="template-card" data-template="ONE_ON_ONE">
                                <div class="template-icon">üë§</div>
                                <div class="template-name">1:1</div>
                            </div>
                            <div class="template-card" data-template="STANDUP">
                                <div class="template-icon">üö©</div>
                                <div class="template-name">Standup</div>
                            </div>
                            <div class="template-card" data-template="IDEA">
                                <div class="template-icon">üí°</div>
                                <div class="template-name">Idea / Brain Dump</div>
                            </div>
                            <div class="template-card" data-template="REFLECTION">
                                <div class="template-icon">‚ù§Ô∏è</div>
                                <div class="template-name">Daily Reflection</div>
                            </div>
                            <div class="template-card" data-template="INTERVIEW">
                                <div class="template-icon">üéì</div>
                                <div class="template-name">Interview / Lecture</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Library View -->
            <div id="libraryView" class="view-container">
                <div class="library-view">
                    <div class="library-header">
                        <div class="search-bar">
                            <span>üîç</span>
                            <input type="text" placeholder="Search notes..." id="searchInput" onkeyup="alfredApp.searchNotes()">
                        </div>
                        <button class="filter-button" onclick="alfredApp.toggleFilters()">üîΩ Advanced Search & Filters</button>
                    </div>
                    <div class="notes-list" id="notesList">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Loading your notes...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat View -->
            <div id="chatView" class="view-container">
                <div class="chat-view">
                    <div class="chat-header">
                        <div class="chat-toggle">
                            <button class="chat-toggle-btn active" data-ai="alfred" onclick="alfredApp.switchAI('alfred')">Alfred</button>
                            <button class="chat-toggle-btn" data-ai="alice" onclick="alfredApp.switchAI('alice')">Alice</button>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message">
                            <div class="message-avatar">A</div>
                            <div class="message-content">
                                <div class="message-text">Hello! I'm Alfred. I've analyzed your note "Idea ‚Äì Nov 20, 2025 4:25PM". Ask me anything about it - I have access to the full transcript, summary, and related content.</div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="chatInput" placeholder="Ask Alfred anything..." rows="1"></textarea>
                        <button class="send-button" id="sendButton" onclick="alfredApp.sendMessage()">‚û§</button>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="view-container">
                <div class="settings-view">
                    <div class="settings-section">
                        <h2 class="section-title">Alfred Backend</h2>
                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Enable Backend Processing</div>
                                <div class="setting-description">Upload recordings to Alfred backend for transcription, summarization, and RAG indexing</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="backendToggle" checked onchange="alfredApp.updateSettings()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Backend API</div>
                                <div class="setting-description">https://api.oip.onl</div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">Token Status</div>
                            <div style="color: var(--success-green); font-weight: 600;">‚úì Token configured</div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="section-title">Upload to Web Server</h2>
                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Store audio files on web server</div>
                                <div class="setting-description">Enable HTTP access to your recordings</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="webServerToggle" checked onchange="alfredApp.updateSettings()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="section-title">LLM Model</h2>
                        <div class="setting-row">
                            <div class="setting-label">Select the model for summarization</div>
                            <select class="model-select" id="modelSelect" onchange="alfredApp.updateSettings()">
                                <option value="llama3.2:3b" selected>Llama 3.2 3B (Fast, good quality - recommended)</option>
                                <option value="llama3.2:1b">Llama 3.2 1B (Fastest, lower quality)</option>
                                <option value="llama3.1:8b">Llama 3.1 8B (Slower, best quality)</option>
                                <option value="gemma2:2b">Gemma 2 2B (Alternative lightweight model)</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="section-title">About</h2>
                        <div class="setting-row">
                            <div class="setting-label">Alfred Meeting Notes</div>
                            <div class="setting-description">Version 1.0.0</div>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">Backend API</div>
                            <div class="setting-description">https://api.oip.onl</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Note Detail View -->
            <div id="noteDetailView" class="view-container">
                <div class="note-detail-view">
                    <div style="margin-bottom: 20px;">
                        <button class="secondary-button" onclick="alfredApp.showView('libraryView')" style="width: auto; padding: 10px 20px;">‚Üê Back to Library</button>
                    </div>
                    <div class="note-detail-header">
                        <h1 class="note-detail-title" id="noteDetailTitle">Note Title</h1>
                        <div class="note-detail-meta">
                            <span id="noteDetailDate">Nov 20, 2025</span>
                            <span id="noteDetailDuration">0m</span>
                        </div>
                    </div>

                    <div class="summary-section">
                        <h2 class="summary-heading">Key Summary</h2>
                        <ul class="summary-list" id="keySummary">
                            <li>Loading...</li>
                        </ul>
                    </div>

                    <div class="summary-section">
                        <h2 class="summary-heading">Action Items</h2>
                        <ul class="summary-list" id="actionItems">
                            <li>Loading...</li>
                        </ul>
                    </div>

                    <div class="summary-section">
                        <h2 class="summary-heading">Open Questions</h2>
                        <ul class="summary-list" id="openQuestions">
                            <li>Loading...</li>
                        </ul>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="primary-button" onclick="alfredApp.chatAboutNote()">üí¨ Chat with Alfred about this note</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="alfredApp.showView('homeView')" data-view="homeView">
                <div class="nav-icon">üè†</div>
                <div>Home</div>
            </button>
            <button class="nav-item" onclick="alfredApp.showView('libraryView')" data-view="libraryView">
                <div class="nav-icon">üìö</div>
                <div>Library</div>
            </button>
            <button class="nav-item" onclick="alfredApp.showView('chatView')" data-view="chatView">
                <div class="nav-icon">üí¨</div>
                <div>Chat</div>
            </button>
            <button class="nav-item" onclick="alfredApp.showView('settingsView')" data-view="settingsView">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div>Settings</div>
            </button>
        </div>

        <!-- Recording Panel -->
        <div class="recording-panel" id="recordingPanel">
            <div class="recording-timer" id="recordingTimer">00:00</div>
            <div class="recording-status">Recording...</div>
            <button class="stop-recording-btn" onclick="alfredApp.stopRecording()">‚èπ Stop Recording</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-card">
            <h2 class="auth-title">Welcome to Alfred Notes</h2>
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="primary-button" onclick="alfredApp.login()">Login</button>
                <div class="auth-toggle">
                    Don't have an account? <a href="#" onclick="alfredApp.showRegister()">Register</a>
                </div>
            </div>
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="Choose a password">
                </div>
                <button class="primary-button" onclick="alfredApp.register()">Register</button>
                <div class="auth-toggle">
                    Already have an account? <a href="#" onclick="alfredApp.showLogin()">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span id="toastIcon">‚úì</span>
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        // Alfred Notes Application
        const alfredApp = {
            // State
            state: {
                isRecording: false,
                mediaRecorder: null,
                audioChunks: [],
                recordingStartTime: null,
                selectedTemplate: 'MEETING',
                notes: [],
                currentNote: null,
                jwtToken: localStorage.getItem('alfred_jwt_token'),
                userEmail: localStorage.getItem('alfred_user_email'),
                theme: localStorage.getItem('alfred_theme') || 'dark',
                settings: {
                    backendEnabled: true,
                    webServerUpload: true,
                    model: 'llama3.2:3b'
                }
            },

            // Initialize app
            init() {
                console.log('üéôÔ∏è Alfred Notes initializing...');
                
                // Initialize theme
                this.initTheme();
                
                // Check authentication
                if (!this.state.jwtToken) {
                    this.showAuthModal();
                } else {
                    this.hideAuthModal();
                    this.loadUserInfo();
                    this.loadNotes();
                }

                // Setup template selection
                this.setupTemplateSelection();
                
                // Setup event listeners
                this.setupEventListeners();
                
                console.log('‚úÖ Alfred Notes ready');
            },

            // Setup template cards
            setupTemplateSelection() {
                const cards = document.querySelectorAll('.template-card');
                cards.forEach(card => {
                    card.addEventListener('click', () => {
                        cards.forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.state.selectedTemplate = card.dataset.template;
                    });
                });
            },

            // Setup event listeners
            setupEventListeners() {
                // Enter key for login
                ['loginEmail', 'loginPassword'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') this.login();
                        });
                    }
                });

                // Enter key for register
                ['registerEmail', 'registerPassword'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') this.register();
                        });
                    }
                });

                // Chat input enter
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                }
            },

            // Authentication
            async login() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;

                if (!email || !password) {
                    this.showToast('Please enter email and password', 'error');
                    return;
                }

                try {
                    const response = await fetch('https://api.oip.onl/api/user/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.state.jwtToken = data.token;
                        this.state.userEmail = email;
                        localStorage.setItem('alfred_jwt_token', data.token);
                        localStorage.setItem('alfred_user_email', email);
                        
                        this.hideAuthModal();
                        this.loadUserInfo();
                        this.loadNotes();
                        this.showToast('Logged in successfully', 'success');
                    } else {
                        this.showToast(data.error || 'Login failed', 'error');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    this.showToast('Login failed: ' + error.message, 'error');
                }
            },

            async register() {
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;

                if (!email || !password) {
                    this.showToast('Please enter email and password', 'error');
                    return;
                }

                try {
                    const response = await fetch('https://api.oip.onl/api/user/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.state.jwtToken = data.token;
                        this.state.userEmail = email;
                        localStorage.setItem('alfred_jwt_token', data.token);
                        localStorage.setItem('alfred_user_email', email);
                        
                        this.hideAuthModal();
                        this.loadUserInfo();
                        this.showToast('Account created successfully', 'success');
                    } else {
                        this.showToast(data.error || 'Registration failed', 'error');
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    this.showToast('Registration failed: ' + error.message, 'error');
                }
            },

            logout() {
                this.state.jwtToken = null;
                this.state.userEmail = null;
                this.state.notes = [];
                localStorage.removeItem('alfred_jwt_token');
                localStorage.removeItem('alfred_user_email');
                this.showAuthModal();
                this.showToast('Logged out successfully', 'success');
            },

            showAuthModal() {
                const modal = document.getElementById('authModal');
                if (modal) modal.classList.remove('hidden');
            },

            hideAuthModal() {
                const modal = document.getElementById('authModal');
                if (modal) modal.classList.add('hidden');
            },

            showLogin() {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
            },

            showRegister() {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
            },

            loadUserInfo() {
                const userEmailEl = document.getElementById('userEmail');
                if (userEmailEl) {
                    userEmailEl.textContent = this.state.userEmail || 'User';
                }
            },

            // Recording
            async toggleRecording() {
                if (this.state.isRecording) {
                    this.stopRecording();
                } else {
                    await this.startRecording();
                }
            },

            async startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.state.mediaRecorder = new MediaRecorder(stream);
                    this.state.audioChunks = [];
                    this.state.recordingStartTime = Date.now();

                    this.state.mediaRecorder.ondataavailable = (event) => {
                        this.state.audioChunks.push(event.data);
                    };

                    this.state.mediaRecorder.onstop = () => {
                        this.processRecording();
                    };

                    this.state.mediaRecorder.start();
                    this.state.isRecording = true;

                    // Update UI
                    document.getElementById('recordButton').classList.add('recording');
                    document.getElementById('recordIcon').textContent = '‚è∏';
                    document.getElementById('recordingPanel').classList.add('active');
                    this.startRecordingTimer();

                    console.log('üéôÔ∏è Recording started');
                } catch (error) {
                    console.error('Error starting recording:', error);
                    this.showToast('Failed to access microphone', 'error');
                }
            },

            stopRecording() {
                if (this.state.mediaRecorder && this.state.isRecording) {
                    this.state.mediaRecorder.stop();
                    this.state.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    this.state.isRecording = false;

                    // Update UI
                    document.getElementById('recordButton').classList.remove('recording');
                    document.getElementById('recordIcon').textContent = 'üé§';
                    document.getElementById('recordingPanel').classList.remove('active');
                    this.stopRecordingTimer();

                    console.log('‚èπÔ∏è Recording stopped');
                }
            },

            startRecordingTimer() {
                this.recordingTimerInterval = setInterval(() => {
                    const elapsed = Date.now() - this.state.recordingStartTime;
                    const seconds = Math.floor(elapsed / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    document.getElementById('recordingTimer').textContent = 
                        `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                }, 1000);
            },

            stopRecordingTimer() {
                if (this.recordingTimerInterval) {
                    clearInterval(this.recordingTimerInterval);
                    this.recordingTimerInterval = null;
                }
            },

            async processRecording() {
                const audioBlob = new Blob(this.state.audioChunks, { type: 'audio/webm' });
                const endTime = Date.now();
                
                this.showToast('Processing recording...', 'success');

                try {
                    await this.uploadNote(audioBlob, this.state.recordingStartTime, endTime);
                } catch (error) {
                    console.error('Error processing recording:', error);
                    this.showToast('Failed to process recording', 'error');
                }
            },

            async uploadNote(audioBlob, startTime, endTime) {
                const formData = new FormData();
                formData.append('audio', audioBlob, 'recording.webm');
                formData.append('start_time', new Date(startTime).toISOString());
                formData.append('end_time', new Date(endTime).toISOString());
                formData.append('note_type', this.state.selectedTemplate); // Keep uppercase - backend expects: MEETING, ONE_ON_ONE, STANDUP, IDEA, REFLECTION, INTERVIEW, OTHER
                formData.append('device_type', 'web');
                formData.append('model', this.state.settings.model);
                formData.append('addToWebServer', this.state.settings.webServerUpload);

                try {
                    const response = await fetch('https://api.oip.onl/api/notes/from-audio', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.state.jwtToken}`
                        },
                        body: formData
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.showToast('Note created successfully!', 'success');
                        this.loadNotes();
                    } else {
                        this.showToast('Failed to create note: ' + (data.error || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    this.showToast('Failed to upload note', 'error');
                }
            },

            // Notes Management
            async loadNotes() {
                if (!this.state.jwtToken) return;

                try {
                    const response = await fetch('https://api.oip.onl/api/records?source=gun&recordType=notes&limit=50&sortBy=date:desc', {
                        headers: {
                            'Authorization': `Bearer ${this.state.jwtToken}`
                        }
                    });

                    const data = await response.json();
                    
                    if (data.records) {
                        this.state.notes = data.records;
                        this.renderNotesList();
                    }
                } catch (error) {
                    console.error('Error loading notes:', error);
                }
            },

            renderNotesList() {
                const notesList = document.getElementById('notesList');
                if (!notesList) return;

                if (this.state.notes.length === 0) {
                    notesList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <div class="empty-text">No notes yet. Start recording!</div>
                        </div>
                    `;
                    return;
                }

                notesList.innerHTML = this.state.notes.map(note => {
                    const basic = note.data?.basic || {};
                    const noteData = note.data?.notes || {};
                    const date = basic.date ? new Date(basic.date * 1000).toLocaleDateString() : 'Unknown';
                    const duration = noteData.audio_ref ? '5m' : 'N/A';
                    const preview = basic.description || noteData.summary_key_points?.[0] || 'No preview available';

                    return `
                        <div class="note-card" onclick="alfredApp.viewNote('${note.did}')">
                            <div class="note-header">
                                <div class="note-title">${basic.name || 'Untitled Note'}</div>
                                <div class="note-badge">${noteData.note_type || 'note'}</div>
                            </div>
                            <div class="note-preview">${preview.substring(0, 150)}...</div>
                            <div class="note-meta">
                                <span>üìÖ ${date}</span>
                                <span>‚è±Ô∏è ${duration}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            async viewNote(noteDid) {
                try {
                    const response = await fetch(`https://api.oip.onl/api/records?source=gun&did=${noteDid}`, {
                        headers: {
                            'Authorization': `Bearer ${this.state.jwtToken}`
                        }
                    });

                    const data = await response.json();
                    
                    if (data.records && data.records[0]) {
                        this.state.currentNote = data.records[0];
                        this.renderNoteDetail();
                        this.showView('noteDetailView');
                    }
                } catch (error) {
                    console.error('Error loading note:', error);
                    this.showToast('Failed to load note', 'error');
                }
            },

            renderNoteDetail() {
                if (!this.state.currentNote) return;

                const basic = this.state.currentNote.data?.basic || {};
                const noteData = this.state.currentNote.data?.notes || {};

                document.getElementById('noteDetailTitle').textContent = basic.name || 'Untitled Note';
                document.getElementById('noteDetailDate').textContent = 
                    basic.date ? new Date(basic.date * 1000).toLocaleDateString() : 'Unknown';
                document.getElementById('noteDetailDuration').textContent = '5m';

                // Key Summary
                const keySummary = document.getElementById('keySummary');
                if (keySummary) {
                    const keyPoints = noteData.summary_key_points || [];
                    keySummary.innerHTML = keyPoints.length > 0 
                        ? keyPoints.map(point => `<li>${point}</li>`).join('')
                        : '<li>No key points available</li>';
                }

                // Action Items
                const actionItems = document.getElementById('actionItems');
                if (actionItems) {
                    const actions = noteData.summary_action_item_texts || [];
                    actionItems.innerHTML = actions.length > 0
                        ? actions.map(action => `<li>${action}</li>`).join('')
                        : '<li>No action items</li>';
                }

                // Open Questions
                const openQuestions = document.getElementById('openQuestions');
                if (openQuestions) {
                    const questions = noteData.summary_open_questions || [];
                    openQuestions.innerHTML = questions.length > 0
                        ? questions.map(q => `<li>${q}</li>`).join('')
                        : '<li>No open questions</li>';
                }
            },

            // Chat
            chatAboutNote() {
                if (!this.state.currentNote) return;
                this.showView('chatView');
                this.addMessage('system', `Loaded note: ${this.state.currentNote.data?.basic?.name}`);
            },

            async sendMessage() {
                const input = document.getElementById('chatInput');
                const question = input.value.trim();
                if (!question || !this.state.currentNote) return;

                input.value = '';

                this.addMessage('user', question);

                try {
                    const response = await fetch('https://api.oip.onl/api/notes/converse', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.state.jwtToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            noteDid: this.state.currentNote.did,
                            question: question,
                            model: this.state.settings.model
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.addMessage('assistant', data.answer);
                    } else {
                        this.addMessage('assistant', 'Sorry, I encountered an error.');
                    }
                } catch (error) {
                    console.error('Chat error:', error);
                    this.addMessage('assistant', 'Sorry, I encountered an error.');
                }
            },

            addMessage(role, text) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'message-avatar';
                avatarDiv.textContent = role === 'user' ? 'U' : 'A';

                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = `<div class="message-text">${text}</div>`;

                messageDiv.appendChild(avatarDiv);
                messageDiv.appendChild(contentDiv);
                chatMessages.appendChild(messageDiv);

                chatMessages.scrollTop = chatMessages.scrollHeight;
            },

            switchAI(ai) {
                document.querySelectorAll('.chat-toggle-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.ai === ai) {
                        btn.classList.add('active');
                    }
                });
            },

            // Views
            showView(viewId) {
                document.querySelectorAll('.view-container').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(viewId)?.classList.add('active');

                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.view === viewId) {
                        item.classList.add('active');
                    }
                });

                if (viewId === 'libraryView') {
                    this.loadNotes();
                }
            },

            // Settings
            updateSettings() {
                this.state.settings.backendEnabled = document.getElementById('backendToggle')?.checked ?? true;
                this.state.settings.webServerUpload = document.getElementById('webServerToggle')?.checked ?? true;
                this.state.settings.model = document.getElementById('modelSelect')?.value ?? 'llama3.2:3b';
                this.showToast('Settings updated', 'success');
            },

            // Search
            searchNotes() {
                const searchInput = document.getElementById('searchInput');
                const query = searchInput?.value.toLowerCase() || '';
                
                if (!query) {
                    this.renderNotesList();
                    return;
                }

                const filtered = this.state.notes.filter(note => {
                    const basic = note.data?.basic || {};
                    const noteData = note.data?.notes || {};
                    return (basic.name || '').toLowerCase().includes(query) ||
                           (basic.description || '').toLowerCase().includes(query) ||
                           (noteData.summary_key_points || []).some(p => p.toLowerCase().includes(query));
                });

                const notesList = document.getElementById('notesList');
                if (!notesList) return;

                if (filtered.length === 0) {
                    notesList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîç</div>
                            <div class="empty-text">No notes found matching "${query}"</div>
                        </div>
                    `;
                    return;
                }

                this.state.notes = filtered;
                this.renderNotesList();
            },

            toggleFilters() {
                this.showToast('Advanced filters coming soon!', 'success');
            },

            // Toast notifications
            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                if (!toast) return;

                toast.className = `toast ${type}`;
                document.getElementById('toastMessage').textContent = message;
                document.getElementById('toastIcon').textContent = type === 'success' ? '‚úì' : '‚ö†';
                toast.classList.remove('hidden');

                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3000);
            },

            // Theme management
            initTheme() {
                // Apply saved theme
                document.documentElement.setAttribute('data-theme', this.state.theme);
                this.updateThemeIcon();
            },

            toggleTheme() {
                // Toggle between light and dark
                this.state.theme = this.state.theme === 'dark' ? 'light' : 'dark';
                
                // Save to localStorage
                localStorage.setItem('alfred_theme', this.state.theme);
                
                // Apply theme
                document.documentElement.setAttribute('data-theme', this.state.theme);
                
                // Update icon
                this.updateThemeIcon();
                
                // Show toast
                this.showToast(`Switched to ${this.state.theme} mode`, 'success');
            },

            updateThemeIcon() {
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.textContent = this.state.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    themeToggle.title = this.state.theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
                }
            }
        };

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => alfredApp.init());
        } else {
            alfredApp.init();
        }
    </script>
</body>
</html>